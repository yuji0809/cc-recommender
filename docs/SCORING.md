# スコアリングシステム

cc-recommenderは、プロジェクト情報に基づいて各推薦アイテムのマッチスコアを計算します。

## スコアの計算方法

### 基本スコア

各マッチタイプに応じてポイントが加算されます：

| マッチタイプ | ポイント | 説明 |
|------------|---------|------|
| **言語マッチ** | +5 / 1件 | プロジェクトで使用されている言語に対応 |
| **フレームワークマッチ** | +4 / 1件 | プロジェクトで使用されているフレームワークに対応 |
| **依存関係マッチ** | +3 / 1件 | プロジェクトの依存関係（package.json等）に直接含まれている |
| **ファイルパターンマッチ** | +2 / 1件 | 特定のファイルパターンが存在する |
| **キーワードマッチ** | +1 / 1件 | 検索キーワード、タグ、名前が一致 |

### スコア倍率

品質指標によって最終スコアが調整されます：

| 倍率 | 条件 | 説明 |
|-----|------|------|
| **×1.3** | 公式アイテム | 公式プラグイン・MCPサーバーには信頼性ボーナス |
| **×1.1** | 高セキュリティ | セキュリティスコア > 80 の安全なアイテム |
| **×0.7** | 低セキュリティ | セキュリティスコア < 50 の要注意アイテム |

### 拡張スコアリング（v0.9.0+）

基本スコアに加えて、プロジェクトのコンテキストと意味的類似性を考慮した高度なスコアリングが追加されました。

#### コンテキストスコア

プロジェクトの特性に基づいて追加ポイントが加算されます：

| ボーナス | ポイント | 条件 |
|---------|---------|------|
| **モノレポ対応** | +3.0 | モノレポプロジェクト × モノレポツール |
| **プロジェクトサイズマッチ** | +2.0 | 大規模 → エンタープライズツール / 小規模 → シンプルツール |
| **チーム規模マッチ** | +1.5 | チーム開発 → コラボレーションツール |

**検出ロジック:**
- モノレポ: `pnpm-workspace.yaml`, `lerna.json`, `packages/`, `apps/` の存在
- プロジェクトサイズ: ファイル数、依存関係数、言語数から分類（small/medium/large/enterprise）
- チーム規模: プロジェクトサイズから推定（solo/small team/medium team/large team）

#### 意味的類似性スコア

タグの共起関係を利用した推薦精度向上：

| ボーナス | 最大ポイント | 説明 |
|---------|------------|------|
| **類似タグ** | +5.0 | プロジェクトタグとアイテムタグの意味的類似性 |

**計算方法:**
- データベース内の全アイテムからタグの共起行列を構築
- Jaccard係数で類似度を計算: `|A ∩ B| / |A ∪ B|`
- プロジェクトタグ: 言語 + フレームワーク + 主要依存関係（上位10個）

**例:** Reactプロジェクト → `testing-library`（react + testingの共起が高い）を推薦

### 最終スコア

生スコアは1-100点の範囲に正規化されます：

```
生スコア = (基本スコアの合計) × (品質倍率) + (コンテキストスコア) + (類似性スコア)
最終スコア = min(100, max(1, (生スコア / 50) × 100))
```

## スコアの意味

| スコア範囲 | 表示 | 意味 |
|-----------|------|------|
| **80-100点** | ✅ 高適合 | プロジェクトに強く推薦します |
| **50-79点** | 👍 適合 | プロジェクトに適合します |
| **20-49点** | 📝 参考 | 参考として有用な場合があります |
| **1-19点** | (非表示) | 関連性が低いため表示されません |

## 計算例

### 例1: TypeScript + React + Supabase プロジェクト

公式のSupabase MCPサーバーを推薦する場合：

```
言語マッチ (TypeScript):    +5
フレームワークマッチ (React): +4
依存関係マッチ (Supabase):   +3
---
基本スコア合計:              12
公式倍率:                    ×1.3
---
生スコア:                    15.6
正規化:                      (15.6 / 50) × 100 = 31点
最終スコア:                  31点 📝 参考

※ さらに多くのマッチがある場合:
生スコア:                    40.0
正規化:                      (40.0 / 50) × 100 = 80点
最終スコア:                  80点 ✅ 高適合
```

### 例2: Python プロジェクト

Python向けのツールを推薦する場合：

```
言語マッチ (Python):         +5
---
基本スコア合計:              5
倍率なし:                    ×1.0
---
生スコア:                    5.0
正規化:                      (5.0 / 50) × 100 = 10点
最終スコア:                  10点 (表示されない)
```

### 例3: 検索キーワード "database"

データベース関連のMCPサーバーを検索する場合：

```
キーワードマッチ (database): +1
キーワードマッチ (tags):     +1
---
基本スコア合計:              2
倍率なし:                    ×1.0
---
生スコア:                    2.0
正規化:                      (2.0 / 50) × 100 = 4点
最終スコア:                  4点 (表示されない)
```

### 例4: モノレポプロジェクト（拡張スコアリング）

TypeScript + React のモノレポプロジェクトに Turborepo を推薦する場合：

```
【基本スコア】
言語マッチ (TypeScript):       +5
フレームワークマッチ (React):    +4
---
基本スコア合計:                 9

【コンテキストスコア】
モノレポ対応:                   +3.0
チーム規模マッチ:               +1.5
---
コンテキストスコア合計:          4.5

【意味的類似性スコア】
類似タグ (monorepo ≈ monorepo): +0.8
類似タグ (react ≈ frontend):    +0.3
---
類似性スコア合計:               1.1

【最終計算】
生スコア:                       9 + 4.5 + 1.1 = 14.6
正規化:                         (14.6 / 50) × 100 = 29点
最終スコア:                     29点 📝 参考

※ コンテキストと類似性により、基本スコアのみ（9点）から
  大幅にスコアアップ（+5.6点）
```

### 例5: React プロジェクト（意味的類似性）

React プロジェクトに @testing-library/react を推薦する場合：

```
【基本スコア】
フレームワークマッチ (React):    +4
依存関係マッチ (react):         +3
---
基本スコア合計:                 7

【意味的類似性スコア】
類似タグ (react ≈ react):       +1.0 (完全一致)
類似タグ (react ≈ testing):     +0.6 (高頻度共起)
類似タグ (typescript ≈ testing): +0.4
---
類似性スコア合計:               2.0

【最終計算】
生スコア:                       7 + 2.0 = 9.0
正規化:                         (9.0 / 50) × 100 = 18点
最終スコア:                     18点 (表示されない)

※ 類似性により、基本スコアのみ（7点）から
  スコアアップ（+2.0点）、表示閾値に近づく
```

## スコアの活用方法

### 推薦結果の解釈

- **✅ 高適合 (80-100点)**: このアイテムはプロジェクトに非常に適しています。優先的にインストールを検討してください。

- **👍 適合 (50-79点)**: このアイテムはプロジェクトに適しています。必要に応じてインストールを検討してください。

- **📝 参考 (20-49点)**: このアイテムは特定の状況で役立つ可能性があります。詳細を確認してから判断してください。

### マッチ内容の確認

推薦結果には「マッチ内容」が表示されます。これにより、なぜそのアイテムが推薦されたのかを理解できます：

```
├─ マッチ内容: 言語: typescript, フレームワーク: react, 依存関係: supabase
```

この情報を見れば、推薦の根拠が明確になります。

## 設定のカスタマイズ

現在、スコアリングの重みや倍率は固定されていますが、将来のバージョンでカスタマイズ可能になる予定です。

詳細は [`src/config/scoring-config.ts`](../src/config/scoring-config.ts) を参照してください。
